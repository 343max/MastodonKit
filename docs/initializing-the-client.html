<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Initializing the Client  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>


    <a title="Initializing the Client  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          MastodonKit Docs
        </a>
         (72% documented)
      </p>
    
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/MastodonKit/MastodonKit">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2FMastodonKit%2Egithub%2Eio%2FMastodonKit%2Fdocs%2Fdocsets%2FMastodonKit%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">MastodonKit Reference</a>
      <img class="carat" src="img/carat.png" />
      Initializing the Client  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Documentation.html">Documentation</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="how-to-install.html">How to Install</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="how-to-build-and-test.html">How to Build and Test</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="initializing-the-client.html">Initializing the Client</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="making-requests.html">Making Requests</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="ranges-and-limits.html">Ranges and Limits</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="uploading-media-attachments.html">Uploading Media Attachments</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Client.html">Client</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Client.html">Client</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Resources.html">Resources</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Accounts.html">Accounts</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Blocks.html">Blocks</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Clients.html">Clients</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Favourites.html">Favourites</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FollowRequests.html">FollowRequests</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Instances.html">Instances</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Login.html">Login</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Media.html">Media</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Mutes.html">Mutes</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Notifications.html">Notifications</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Reports.html">Reports</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Search.html">Search</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Statuses.html">Statuses</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Timelines.html">Timelines</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Entities.html">Entities</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Account.html">Account</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Application.html">Application</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Attachment.html">Attachment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Card.html">Card</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ClientApplication.html">ClientApplication</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Context.html">Context</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Instance.html">Instance</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/LoginSettings.html">LoginSettings</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Mention.html">Mention</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Notification.html">Notification</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Relationship.html">Relationship</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Report.html">Report</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Results.html">Results</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Status.html">Status</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Tag.html">Tag</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Enums.html">Other Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/AccessScope.html">AccessScope</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/AttachmentType.html">AttachmentType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ClientError.html">ClientError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/MediaAttachment.html">MediaAttachment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/NotificationType.html">NotificationType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ResourceRange.html">ResourceRange</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Visibility.html">Visibility</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Structs.html">Other Structs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other Structs.html#/s:V11MastodonKit8Resource">Resource</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='initializing-the-client' class='heading'>Initializing the Client</h1>

<p>Assuming you already have an access token for a user on the given Mastodon instance:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">client</span> <span class="o">=</span> <span class="kt">Client</span><span class="p">(</span>
    <span class="nv">baseURL</span><span class="p">:</span> <span class="s">"https://mastodon.technology"</span><span class="p">,</span>
    <span class="nv">accessToken</span><span class="p">:</span> <span class="s">"user access token (after OAuth login)"</span>
<span class="p">)</span>
</code></pre>

<p>Shall you need to get an access token, you must first register the application against the given Mastodon instance. Registering an application returns the Client ID and Client Secret needed to perform the OAuth call. Remember to store the Client ID and Client Secret locally in your application for future OAuth logins:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">client</span> <span class="o">=</span> <span class="kt">Client</span><span class="p">(</span><span class="nv">baseURL</span><span class="p">:</span> <span class="s">"https://mastodon.technology"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">resource</span> <span class="o">=</span> <span class="kt">Clients</span><span class="o">.</span><span class="nf">register</span><span class="p">(</span>
    <span class="nv">clientName</span><span class="p">:</span> <span class="s">"MastodonKit Test Client"</span><span class="p">,</span>
    <span class="nv">scopes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="o">.</span><span class="n">follow</span><span class="p">],</span>
    <span class="nv">website</span><span class="p">:</span> <span class="s">"https://github.com/MastodonKit/MastodonKit"</span>
<span class="p">)</span>

<span class="n">client</span><span class="o">.</span><span class="nf">run</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span> <span class="p">{</span> <span class="n">application</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">application</span> <span class="o">=</span> <span class="n">application</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"id: </span><span class="se">\(</span><span class="n">application</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"redirect uri: </span><span class="se">\(</span><span class="n">application</span><span class="o">.</span><span class="n">redirectURI</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"client id: </span><span class="se">\(</span><span class="n">application</span><span class="o">.</span><span class="n">clientID</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"client secret: </span><span class="se">\(</span><span class="n">application</span><span class="o">.</span><span class="n">clientSecret</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>After retrieving the access token (via standard OAuth 2 authorization flow), update the MastodonKit client with the returned accessToken:</p>
<pre class="highlight swift"><code><span class="n">client</span><span class="o">.</span><span class="n">accessToken</span> <span class="o">=</span> <span class="s">"user access token (after OAuth login)"</span>
</code></pre>

<p><strong>Side note</strong>: Mastodon&rsquo;s API and MastodonKit offer a way to silently log a user in, but the method is discouraged. The <a href="https://github.com/tootsuite/documentation/blob/master/Using-the-API/Testing-with-cURL.md">API documentation</a> recommends using the standard OAuth 2 authorization flow instead.</p>

<blockquote>
<p><em><q>Please note that the password-based approach is not recommended especially if you&rsquo;re dealing with other user&rsquo;s accounts and not just your own. Usually you would use the authorization grant approach where you redirect the user to a web page on the original site where they can login and authorize the application and are then redirected back to your application with an access code.</q></em> - Mastodon&rsquo;s API Documentation</p>
</blockquote>

<p>But in case you want to test it with your own account, here is how:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">loginResource</span> <span class="o">=</span> <span class="kt">Login</span><span class="o">.</span><span class="nf">silent</span><span class="p">(</span>
    <span class="nv">clientID</span><span class="p">:</span> <span class="s">"very long client id"</span><span class="p">,</span>
    <span class="nv">clientSecret</span><span class="p">:</span> <span class="s">"very long client secret"</span><span class="p">,</span>
    <span class="nv">scopes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="o">.</span><span class="n">write</span><span class="p">],</span>
    <span class="nv">username</span><span class="p">:</span> <span class="s">"foo"</span><span class="p">,</span>
    <span class="nv">password</span><span class="p">:</span> <span class="s">"bar"</span>
<span class="p">)</span>

<span class="n">client</span><span class="o">.</span><span class="nf">run</span><span class="p">(</span><span class="n">loginResource</span><span class="p">)</span> <span class="p">{</span> <span class="n">loginSettings</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">loginSettings</span> <span class="o">=</span> <span class="n">loginSettings</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"access token: </span><span class="se">\(</span><span class="n">loginSettings</span><span class="o">.</span><span class="n">accessToken</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Bear in mind the method above should never be used when deadling with other user&rsquo;s accounts.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2017 <a class="link" href="https://github.com/MastodonKit/MastodonKit" target="_blank" rel="external">Ornithologist Coder and MastodonKit Contributors</a>. All rights reserved. (Last updated: 2017-05-13)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.8.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
